odoo.define("medical_js.medical_base",function(require){"use strict";var i=require("medical_js.BaseWidget"),
    n=require("web.core"),
    s=i.Chrome,c=i.gui,t=i.screens;n.qweb;var r=n._t;c.Gui.include({_show_first_screen:function(){var e=this;this._super.apply(this,arguments),$(".v-menu-control").bind("contextmenu",function(e){e.preventDefault(),$(".custom-menu").finish().toggle(100).css({top:e.pageY+"px",left:e.pageX+"px"})}),$(".v-menu-control").bind("mousedown",function(e){!$(e.target).parents(".custom-menu").length>0&&$(".custom-menu").hide(100)}),$(".custom-menu li").click(function(){switch($(this).attr("data-action")){case"opt1":$("body").addClass("sidebar-collapse").removeClass("sidebar-mini");break;case"opt2":$("body").addClass("sidebar-collapse sidebar-mini");break;case"opt3":$("body").removeClass("sidebar-collapse sidebar-mini")}$(".custom-menu").hide(100)}),$(".js_clinic").change(function(i){var n=parseInt($(this).val()),s=parseInt($("#js_resource_group").val());e.update_calendar_resources(n,s),e.medical.get_order().set_clinic(n)}),$("#js_resource_group").change(function(i){var n=parseInt($(".js_clinic").val()),s=parseInt($(this).val());e.update_calendar_resources(n,s)});var i=e.medical.current_clinic;i&&$(".js_clinic").val(i.id).trigger("change"),this.renderEmployeePanel()},update_calendar_resources:function(e,i){var n=this.medical.db.clinic_by_id[e],s=this.medical.resource_group_by_id[i];this.medical.current_clinic=n;var c=this.current_screen.calendar,t=[];c&&(s?n?_.each(s.resources,function(e){_.contains(n.resource_ids,e.id)&&t.push(e)}):t=s.resources:t=n?n.resources||[]:this.medical.db.cal_resources,t&&(this.medical.chrome.blockUI(),_.each(c.getResources(),function(e){e.remove()}),_.each(t,function(e){c.addResource(e)}),this.medical.chrome.unblockUI()),c.refetchEvents())},renderEmployeePanel:function(){var e=this,i=$(".user-panel");function n(n){n&&n.name||(n=e.medical.employee),n&&(i.find("img").src="/web/image/hr.employee/"+n.id+"/image_1920/100x60",i.find(".info a").html(n.name))}var s=e.medical.get_cashier();s.name&&n(s),i.click(function(){e.select_employee({security:!0,only_managers:!1,title:r("Change Employee")}).then(function(i){i&&(e.medical.set_cashier(i),n(i))})})},select_employee:function(e){e=e||{};var i=this,n=[];return i.medical.allowed_employees.forEach(function(i){e.only_managers&&"manager"!==i.role||n.push({label:i.name,item:i})}),new Promise(function(s,c){i.show_popup("selection",{title:e.title||r("Select User"),list:n,confirm:s,cancel:c,is_selected:function(e){return e===i.medical.get_cashier()}})}).then(function(e){return i.ask_password(e.pin).then(function(){return e})})},ask_password:function(e){var i=this;return new Promise(function(n,s){e?i.show_popup("password",{title:r("Password ?"),confirm:function(c){c!==e?(i.show_popup("error",r("Incorrect Password")),s()):n()}}):n()})}});var a=t.ScreenWidget.extend({template:"LoginScreenWidget",show:function(){var e=this;this.$(".select-employee").click(function(){e.gui.select_employee({security:!0,current_employee:e.medical.get_cashier(),title:r("Select Employee")}).then(function(i){e.medical.set_cashier(i),e.gui.renderEmployeePanel(),e.unlock_screen()})}),$("#sidebar_menu").addClass("oe_hidden"),this.$(".close-session").click(function(){e.gui.close()}),this._super()},hide:function(){this._super(),$("#sidebar_menu").removeClass("oe_hidden")},unlock_screen:function(){this.gui.show_screen("calendar")}});c.define_screen({name:"session-login",widget:a}),s.include({build_widgets:function(){this._super.apply(this,arguments);var e="calendar";this.medical.config.enable_login&&(e="session-login"),this.gui.set_startup_screen(e),this.gui.set_default_screen(e)}})});