odoo.define("medical_js.global_disc",function(require){"use strict";var i=require("medical_js.appointment"),
    e=require("medical_js.BaseWidget"),
    o=require("medical_js.models"),
    n=require("web.core");require("web.rpc"),
    e.PopupWidget;var s=n._t,r=i.ActionButtonWidget.extend({template:"BtnGlobalDiscount",button_click:function(){var t=this,i=this.medical.get_cashier(),e=this.medical.get_order();this.gui.show_popup("popup-discount",{disc_perc:0,disc_fix:0,show_reason:!0,reason_id:e.disc_reason_id,confirm:function(o,n,r){r=r||"";var a=e.get_orderlines();if(_.isEmpty(a)){t.chrome.error_toast(s("Please add services first."));return}if(i&&0!=i.max_discount){if(o>i.max_discount){t.chrome.error_toast(s("You are not allowed to apply discount more than "+i.max_discount+" %"));return}var c=e.get_total_without_discount()*i.max_discount/100;if(n>c){t.chrome.error_toast(s("You are not allowed to apply discount more than "+c));return}}if(e.disc_reason_id=r,!o&&n){var d,l=n;n/=a.length||1;var u=(n=parseFloat(n=n.toFixed(2)))*a.length||1;for(d=0;d<a.length;d++)a[d].set_discount(0);for(d=0;d<a.length;d++)if(d==a.length-1&&l!=u){if(u>l){var f=u-l;n-=f}if(l>u){var f=l-u;n+=f}a[d].set_fix_discount(n)}else a[d].set_fix_discount(n)}!n&&o&&_.each(a,function(t){o&&(t.set_fix_discount(0),t.set_discount(o))})}})}});i.define_action_button({name:"appointment_global_disc",widget:r,condition:function(){return console.log("___ config.allow_global_disc : ",this.medical.config.allow_global_disc),this.medical.config.allow_global_disc}});var a=o.Order.prototype;o.Order=o.Order.extend({export_as_JSON:function(){var t=a.export_as_JSON.apply(this,arguments);return t.disc_reason_id=this.disc_reason_id,t}})});