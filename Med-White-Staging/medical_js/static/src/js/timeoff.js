odoo.define("medical_js.timeoff",function(require){"use strict";var t=require("medical_js.BaseWidget"),
    i=require("web.core"),
    s=require("web.utils"),
    r=t.PopupWidget;t.screens;var a=t.Chrome,o=t.gui;i.qweb;var n=i._t;s.round_precision;var c=r.extend({template:"TimeoffAddPopup",start:function(){this._super.apply(this,arguments),this.leave_status_id=this.medical.config.allow_time_off&&this.medical.config.time_off_type_id&&this.medical.config.time_off_type_id[0],this.display_hour_list=[["8","8:00 AM"],["8.5","8:30 AM"],["9","9:00 AM"],["9.5","9:30 AM"],["10","10:00 AM"],["10.5","10:30 AM"],["11","11:00 AM"],["11.5","11:30 AM"],["12","12:00 PM"],["12.5","0:30 PM"],["13","1:00 PM"],["13.5","1:30 PM"],["14","2:00 PM"],["14.5","2:30 PM"],["15","3:00 PM"],["15.5","3:30 PM"],["16","4:00 PM"],["16.5","4:30 PM"],["17","5:00 PM"],["17.5","5:30 PM"],["18","6:00 PM"],["18.5","6:30 PM"],["19","7:00 PM"],["19.5","7:30 PM"]]},renderElement:function(){this._super();var e=this,t=this.options&&this.options.leave;this.callback=this.options&&this.options.callback,_.isObject(t)&&_.each(_.keys(t),function(i){var s=t[i];"resource_id"==i&&(s=t[i]&&t[i][0]),e.$("[name='"+i+"']").val(s)}),e.$("select").select2()},click_confirm:function(){var e,t=this,i={},s=!1;_.each(this.$("input, select"),function(e){if(e.name){var t=$(e).parents("tr").children("th"),r=e.name,a=e.value;-1!=_.indexOf(["holiday_status_id","resource_id"],r)&&(a=parseInt(a)),t.children("span").remove(),i[r]=a,a||_.contains(["id"],r)||(t.append("<span class='text-danger'> * </span>"),s=!0)}});var r=parseInt(this.$('select[name="resource_id"]').val()),a=t.medical.resource_by_id[r].hr_staff_id[0];delete i.resource_id;var o=moment(i.request_date_from,this.chrome.date_format).format(this.chrome.date_server_format),c=this.floatToHourMin(i.request_hour_from),d=this.floatToHourMin(i.request_hour_to),u=this.get_server_datetime(o+" "+c.hours+":"+c.minutes+":00"),l=this.get_server_datetime(o+" "+d.hours+":"+d.minutes+":00");if(i.employee_id=a,i.request_date_from=o,i.request_date_to=o,i.date_from=u,i.date_to=l,i.request_unit_hours=!0,console.info("___ Creating/Updating Time Off : ",i.id,i),s||!a){this.chrome.error_toast("* Field values missing...!",n("Missing"));return}return i.id?e=this._rpc({model:"hr.leave",method:"write",args:[[i.id],i]}):(delete i.id,e=this._rpc({model:"hr.leave",method:"create",args:[i]})),e.then(function(e){return t.chrome.success_toast("Time Off Updated Successfully."),t.callback&&t.callback(),t.gui.close_popup(),t.gui.current_screen.show(!0),e})}});o.define_popup({name:"timeoff-add",widget:c});var d=t.StatusWidget.extend({template:"TimeoffIcon",start:function(){var e=this;this.$el.off("click"),this.$el.click(function(t){var i=e.chrome.gui,s={};i.current_screen.calendar&&(s={leave:{request_date_from:e.format_date(i.current_screen.getCurrentDate())}}),i.show_popup("timeoff-add",s)})}});a.include({build_widgets:function(){this.medical.config.allow_time_off&&this.widgets.push({name:"timeoff_app",widget:d,append:".v-top-right"}),this._super.apply(this,arguments)}})});