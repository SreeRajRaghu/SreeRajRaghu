odoo.define("medical_js.prepaid_card",function(require){"use strict";var t=require("medical_js.appointment"),
    i=require("medical_js.BaseWidget"),
    a=require("web.core");
    a.qweb;var n=a._t,p=i.PopupWidget.extend({template:"PrepaidCardDetailsPopup",events:_.extend({},i.PopupWidget.prototype.events,{"click .cancel":"click_cancel","click .v-prepaid-card-add":"add_prepaid_card","click .v-payment-print":"print_payment_receipt"}),print_payment_receipt:function(e){e.stopPropagation();var t=Number($(e.currentTarget).data().payment);this.medical.chrome.print_report(this.report_tags.payment+"/"+t,"qweb-pdf")},add_prepaid_card:function(e){e.stopPropagation();var t=this,i=this.options.partner,a=$(e.currentTarget).data(),n=Number(a.card);t.gui.show_popup("popup-register-payment",{order:!1,partner:i,partner_id:i.id,ref:a.name,prepaid_card_id:n,confirm:function(){t.gui.current_screen.fetch_prepaid_card_details(i,n)}})}});i.gui.define_popup({name:"popup-prepaid-card-details",widget:p}),t.RegisterPayment.include({prepare_payment_lines:function(){var e=this,t=this._super.apply(this,arguments);return this.medical.config.enable_prepaid_card&&this.options.prepaid_card_id&&_.each(t,function(t){t.prepaid_card_id=e.options.prepaid_card_id||!1}),t}});var r=i.PopupWidget.extend({template:"PaymentByPrepaidCardPopup",events:_.extend({},i.PopupWidget.prototype.events,{"click .cancel":"click_cancel","click .v-confirm":"confirm_payment","click .v-reset":"render_reset_payment","change input.v-card-pay":"compute_tot_pay"}),show:function(){this._super.apply(this,arguments),this.prepaid_cards=this.options.prepaid_cards,this.invoice_widget=this.options.invoice_widget,this.invoice_data=this.invoice_widget.invoice_data,this.payment_lines={}},render_reset_payment:function(e){this.$(".v-card-pay").val(""),this.$(".v-card-pay:first").focus()},compute_tot_pay:function(){var e=this.compute_payble_lines();this.$(".v-tot-pay").html(this.format_currency(e))},compute_payble_lines:function(){var e=this,t=0,i=this.payment_lines;return _.each(this.$(".v-card-pay"),function(a){var p=Number($(a).data().max),r=Number(a.name),o=Number(a.value);if(p<o)return e.chrome.warning_toast(n("Amount cannot paid greater than the balance.")),0;i[r]=o,t+=o}),this.payment_lines=i,t},confirm_payment:function(e){if(e.stopPropagation(),_.isEmpty(this.options.move_lines_amount)){this.chrome.warning_toast(n("Invoice line(s) required to select."));return}var t=this.compute_payble_lines();if(t<=0){this.chrome.warning_toast(n("Please fill the amount."));return}if(t>this.options.to_pay){this.chrome.warning_toast(n("Amount cannot be greater the total of selected invoice lines."));return}var i=[this.payment_lines,this.options.move_lines_amount];console.info("___ Register Prepaid Payment : ",i),this._rpc({model:"partner.prepaid.card",method:"js_card_payment",args:i}).then(function(e){console.log("___ result : ",e)})}});i.gui.define_popup({name:"popup-prepaid-card-payment",widget:r})});